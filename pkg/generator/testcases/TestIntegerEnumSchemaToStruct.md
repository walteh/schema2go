# json-schema

```json
{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"title": "HttpConfig",
	"type": "object",
	"properties": {
		"port": {
			"type": "integer",
			"enum": [80, 443, 8080, 8443]
		},
		"status": {
			"type": "integer",
			"enum": [200, 404, 500]
		}
	}
}
```

---

# go-code

```go
// Code generated by schema2go. DO NOT EDIT.
// üèóÔ∏è Generated from JSON Schema

package models

import (
    "encoding/json"
    "gitlab.com/tozd/go/errors"
)

type PortType int

const (
    PortType80   PortType = 80
    PortType443  PortType = 443
    PortType8080 PortType = 8080
    PortType8443 PortType = 8443
)

type StatusType int

const (
    StatusType200 StatusType = 200
    StatusType404 StatusType = 404
    StatusType500 StatusType = 500
)

type HttpConfig struct {
    Port   *PortType   `json:"port,omitempty"`
    Status *StatusType `json:"status,omitempty"`
}

func (x *HttpConfig) UnmarshalJSON(data []byte) error {
    type Alias HttpConfig
    aux := &struct {
        *Alias
    }{
        Alias: (*Alias)(x),
    }

	if err := json.Unmarshal(data, &aux); err != nil {
		return errors.Errorf("unmarshaling json: %w", err)
	}

	if err := x.Validate(); err != nil {
		return errors.Errorf("validating after unmarshal: %w", err)
	}

    return nil
}

// Validate ensures all required fields are present and valid
func (x *HttpConfig) Validate() error {
    if x.Port != nil {
        switch *x.Port {
        case PortType80, PortType443, PortType8080, PortType8443:
        default:
            return errors.New("invalid port")
        }
    }
    if x.Status != nil {
        switch *x.Status {
        case StatusType200, StatusType404, StatusType500:
        default:
            return errors.New("invalid status")
        }
    }
    return nil
}

// MarshalJSON implements json.Marshaler
func (x HttpConfig) MarshalJSON() ([]byte, error) {
    // Validate before marshaling
    if err := x.Validate(); err != nil {
        return nil, errors.Errorf("validating before marshal: %w", err)
    }

    // Use alias to avoid infinite recursion
    type Alias HttpConfig
    return json.Marshal((*Alias)(&x))
}
```
