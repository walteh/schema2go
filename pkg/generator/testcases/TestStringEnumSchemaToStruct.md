# input

```json
{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"title": "ColorConfig",
	"type": "object",
	"properties": {
		"primaryColor": {
			"type": "string",
			"enum": ["red", "green", "blue"]
		},
		"theme": {
			"type": "string",
			"enum": ["light", "dark"],
			"default": "light"
		}
	}
}
```

---

# expected-output

```go
// Code generated by schema2go. DO NOT EDIT.
// üèóÔ∏è Generated from JSON Schema

package models

import (
    "encoding/json"
    "gitlab.com/tozd/go/errors"
)

type ColorType string

const (
    ColorTypeRed   ColorType = "red"
    ColorTypeGreen ColorType = "green"
    ColorTypeBlue  ColorType = "blue"
)

type ThemeType string

const (
    ThemeTypeLight ThemeType = "light"
    ThemeTypeDark  ThemeType = "dark"
)

type ColorConfig struct {
    PrimaryColor *ColorType `json:"primaryColor,omitempty"`
    Theme        *ThemeType `json:"theme,omitempty"` // Default: light
}

// UnmarshalJSON implements json.Unmarshaler
func (x *ColorConfig) UnmarshalJSON(data []byte) error {
    // Define an alias to prevent recursive UnmarshalJSON calls
    type Alias ColorConfig
    aux := &struct {
        *Alias
    }{
        Alias: (*Alias)(x),
    }
    if err := json.Unmarshal(data, &aux); err != nil {
        return errors.Errorf("unmarshaling json: %w", err)
    }

    // Apply defaults for missing fields
    if x.Theme == nil {
        defaultValue := ThemeTypeLight
        x.Theme = &defaultValue
    }

    // Validate after applying defaults
    if err := x.Validate(); err != nil {
        return errors.Errorf("validating after unmarshal: %w", err)
    }

    return nil
}

// Validate ensures all required fields are present and valid
func (x *ColorConfig) Validate() error {
    if x.PrimaryColor != nil {
        switch *x.PrimaryColor {
        case ColorTypeRed, ColorTypeGreen, ColorTypeBlue:
        default:
            return errors.New("invalid primaryColor")
        }
    }
    if x.Theme != nil {
        switch *x.Theme {
        case ThemeTypeLight, ThemeTypeDark:
        default:
            return errors.New("invalid theme")
        }
    }
    return nil
}

// MarshalJSON implements json.Marshaler
func (x ColorConfig) MarshalJSON() ([]byte, error) {
    // Validate before marshaling
    if err := x.Validate(); err != nil {
        return nil, errors.Errorf("validating before marshal: %w", err)
    }

    // Use alias to avoid infinite recursion
    type Alias ColorConfig
    return json.Marshal((*Alias)(&x))
}
```
